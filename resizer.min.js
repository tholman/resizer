function ResizerCanvas(t){this.el=t}ResizerCanvas.prototype.style,ResizerCanvas.prototype.context,ResizerCanvas.prototype._fontSize=function(){return parseInt(this.el.style.fontSize||this.$style("font-size"))},ResizerCanvas.prototype._fontFamily=function(){return this.el.style.fontFamily||this.$style("font-family")},ResizerCanvas.prototype._text=function(){return this.el.value||this.el.innerHTML},ResizerCanvas.prototype._textLength=function(){return parseInt(this._text().length)},ResizerCanvas.prototype._scrollWidth=function(){return parseInt(this.$style("width"))},ResizerCanvas.prototype.$style=function(t,e){return(!this.style||e)&&(this.style=document.defaultView.getComputedStyle(this.el)),t?this.style.getPropertyValue(t):this.style},ResizerCanvas.prototype.$context=function(){if(!this.context){var t=document.createElement("canvas");this.context=t.getContext("2d")}return this.context},ResizerCanvas.prototype.Resize=function(t,e){for(;this.resizable(t>0,e);){var n=this._fontSize()+t;this.el.style.fontSize=n+"px"}},ResizerCanvas.prototype.resizable=function(t,e){var n=t?1:-1,i=this.checkTextWidth(n),s=n*this._fontSize()<n*e,o=n*i<n*this._scrollWidth();return s&&o},ResizerCanvas.prototype.checkTextWidth=function(t){var e=this._text(),n=this._fontSize();return t>0&&(n+=1),this.$context().font=n+"px "+this._fontFamily(),this.$context().fillText?this.$context().measureText(e).width:this.$context().mozDrawText?this.$context().mozMeasureText(e):void 0},ResizerCanvas.prototype.onKeyDown=function(t){if(t){var e=this;this.el.onkeydown=function(){t(e._textLength())}}};
function Resizer(t,i){this.canvas=new ResizerCanvas(t),this.dataset=t.dataset,this.Initialize(i)}Array.prototype.uniq||(Array.prototype.uniq=function(){this.sort();for(var t=this.length-1;t>=0;t--)this[t]==this[t-1]&&delete this[t];return this}),Resizer.prototype.minFontSize=11,Resizer.prototype._initDataKeys=["maxFontSize","cachedLength"],Resizer.prototype._maxScrollWidth=function(t){return this.data("maxScrollWidth",this.canvas._scrollWidth(),t)},Resizer.prototype._maxFontSize=function(t){return this.data("maxFontSize",this.canvas._fontSize(),t)},Resizer.prototype._minFontSize=function(t){return this.data("minFontSize",this.minFontSize,t)},Resizer.prototype._cachedLength=function(t){return this.data("cachedLength",this.canvas._textLength(),t)},Resizer.prototype.Initialize=function(t){for(var i=this,e=this.initDataKeys(t||{}),n=0;n<e.length;n++){var o=e[n];"function"==typeof i["_"+o]&&i["_"+o](t&&t[o]||void 0)}this.AddListeners()},Resizer.prototype.AddListeners=function(){var t=this;this.canvas.onKeyDown(function(i){t.Resize(i)})},Resizer.prototype.Resize=function(t){t<this._cachedLength()?this.Grow():this.Shrink(),this._cachedLength(t)},Resizer.prototype.Grow=function(){this.addToFontSize(1)},Resizer.prototype.Shrink=function(){this.addToFontSize(-1)},Resizer.prototype.initDataKeys=function(t){var i=this._initDataKeys.concat(Object.keys(t||{}));return i.uniq()},Resizer.prototype.data=function(t,i,e){return this._data(t,e||i,void 0!==e)},Resizer.prototype.addToFontSize=function(t){var i=parseInt(t);if(0!==i){var e=i>0?this._maxFontSize():this._minFontSize();this.canvas.Resize(i,e)}},Resizer.prototype._data=function(t,i,e){var n=this._config("resizer")||{},o=n[t];return!i||o&&!e||(o=n[t]=i,this._config("resizer",n)),o},Resizer.prototype._config=function(t,i){var e=i;void 0!==e&&"string"!=typeof e&&(e=JSON.stringify(e));var n=this.config(t||void 0,e||void 0);return"string"==typeof n?JSON.parse(n):n},Resizer.prototype.config=function(t,i){return this.dataset||(this.dataset=this.canvas.el.dataset),void 0!==i&&(this.dataset[t]=i),void 0===t?this.dataset:this.dataset[t]};
function ResizerManager(){if(arguments.length>0){var e;e=arguments[arguments.length-1],e.constructor==Object?delete arguments[arguments.length-1]:e=void 0,this.New(arguments,e)}}ResizerManager.prototype.New=function(e,n){var t=this;if(e instanceof HTMLElement)new Resizer(e,n);else if(e instanceof Array||e instanceof NodeList||e instanceof Object)for(var r=0;r<e.length;r++)t.New(e[r],n)};
